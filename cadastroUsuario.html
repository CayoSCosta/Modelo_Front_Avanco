<?php include 'layout/header.php'; ?>
<div class="contact" id="contact">

    <div id="mensagem-banner" class="alert" style="display: none;">
        <div id="progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        <div id="mensagem-texto"></div>
    </div>

    <div class="box-container">
        <div class="box">
            <h4 class="contato" style="font-weight: bold;">Faça seu cadastro e tenha acesso aos nossos catálogos</h4>
            <form id="cadastro" action="#" method="post" onsubmit="return enviarFormulario()">
                <div class="row">
                    <div class="col">
                        <label for="nome">Nome*</label>
                        <input type="text" name="nome" id="nome" class="form-control">
                    </div>
                    <div class="col custom-col">
                        <label for="sobrenome">Sobrenome*</label>
                        <input type="text" name="sobrenome" id="sobrenome" class="form-control">
                    </div>
                </div>

                <div class="col">
                    <label for="email">E-mail*</label>
                    <input type="email" name="email" id="email">
                </div>

                <div class="col">
                    <label for="senha">Senha*</label>
                    <input type="password" name="senha" id="senha">
                </div>

                <div class="col">
                    <label for="confirmesenha">Confirme a senha*</label>
                    <input type="password" name="confirmesenha" id="confirmesenha" oninput="validarSenha()">
                    <p id="mensagem-erro" class="erro"></p>
                </div>

                <div class="col">
                    <label for="telefone">Telefone*</label>
                    <input type="tel" name="telefone" id="telefone">
                </div>

                <div class="col">
                    <label for="empresa">Empresa*</label>
                    <input type="text" name="empresa" id="empresa">
                </div>

                <div class="row">
                    <div class="col custom-col">
                        <label for="uf">UF*</label>
                        <select name="uf" id="uf" class="form-control">
                            <option class="select-option" value="UF" selected>UF*</option>
                            <option class="select-option" value="SP">SP</option>
                            <option class="select-option" value="RJ">RJ</option>
                            <option class="select-option" value="ES">ES</option>
                            <option class="select-option" value="MG">MG</option>
                        </select>
                    </div>
                    <div class="col custom-col">
                        <label for="cidade">Cidade*</label>
                        <input type="text" name="cidade" id="cidade" class="form-control">
                    </div>
                </div>


                <div class="row">
                    <div class="col">
                        <label for="area">Área de Atuação*</label>
                        <select name="area" id="area">
                            <option class="select-option" value="valor1" selected>Área de Atuação*</option>
                            <option class="select-option" value="valor2">Escritório de Arquitetura e Design</option>
                            <option class="select-option" value="valor3">Engenharia e Construção Civil</option>
                            <option class="select-option" value="valor4">Consultoria em Acústica</option>
                            <option class="select-option" value="valor5">Departamento de Compras</option>
                        </select>
                    </div>
                </div>

                <div class="btn-contato">
                    <input class="btn-submit" type="submit" value="Cadastrar">
                </div>
            </form>
        </div>
    </div>




    <!-- echo json_encode(['scriptPath' => $scriptPath]); -->


    <script>
        function validarSenha() {
            var senha = document.getElementById("senha").value;
            var confirmesenha = document.getElementById("confirmesenha").value;
            var mensagemErro = document.getElementById("mensagem-erro");

            if (senha !== confirmesenha) {
                mensagemErro.innerHTML = "*As senhas não conferem.";
                return false;
            } else {
                mensagemErro.innerHTML = "";
                return true;
            }
        }

        function enviarFormulario() {
            if (validarSenha()) {
                var formulario = document.getElementById("cadastro");
                var dadosFormulario = new FormData(formulario);

                fetch("..\\db\\processarCadastro.php", {
                        method: "POST",
                        body: dadosFormulario
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            exibirMensagem(data.message, "sucesso");
                            $('html, body').animate({
                                scrollTop: 0
                            }, 'slow'); // Animação suave ao rolar para o topo
                            // Redirecione ou realize outras ações após um cadastro bem-sucedido, se necessário.
                        } else {
                            exibirMensagem(data.message, "erro");
                        }
                    })
                    .catch(error => {
                        console.error("Erro ao processar o formulário:", error);
                    });
            }

            return false; // Evita o envio tradicional do formulário
        }

        function exibirMensagem(mensagem, tipo) {
            var mensagemBanner = document.getElementById("mensagem-banner");
            var progressBar = document.getElementById("progress-bar");
            var mensagemTexto = document.getElementById("mensagem-texto");

            mensagemBanner.style.display = "block";

            // Remover classes existentes
            mensagemBanner.classList.remove("alert-success", "alert-danger");
            progressBar.classList.remove("bg-success", "bg-danger");

            if (tipo === "sucesso") {
                mensagemBanner.classList.add("alert-success");
                progressBar.classList.add("bg-success");
            } else if (tipo === "erro") {
                mensagemBanner.classList.add("alert-danger");
                progressBar.classList.add("bg-danger");
            }

            progressBar.style.width = "100%";
            mensagemTexto.innerHTML = mensagem;

            var tempoTotal = 3000; // Tempo total de exibição em milissegundos
            var intervalo = 100; // Intervalo para atualização da barra de progresso

            var progresso = 0;

            var animacao = setInterval(function() {
                progressBar.style.width = (progresso / tempoTotal) * 100 + "%";
                progresso += intervalo;

                if (progresso >= tempoTotal) {
                    clearInterval(animacao);
                    mensagemBanner.style.display = "none";

                    // Redireciona para a index.php após a animação da barra de progresso
                    window.location.href = "/";
                }
            }, intervalo);
        }
    </script>